<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Quotes</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* [ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼] ë ˆíŠ¸ë¡œ ê°ì„±ì„ ìœ„í•œ CSS */
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Noto+Sans+KR:wght@400;700&display=swap');

        :root {
            --bg-color: #e0e7ff;
            --window-bg: #fff1e6;
            --border-color: #2d2d2d;
            --accent-blue: #93c5fd;
            --accent-red: #fca5a5;
            --accent-yellow: #fbbf24;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            background-image: 
                linear-gradient(var(--accent-blue) 1px, transparent 1px),
                linear-gradient(90deg, var(--accent-blue) 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--border-color);
            overflow-x: hidden;
        }

        /* ë ˆíŠ¸ë¡œ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .retro-box {
            background-color: var(--window-bg);
            border: 3px solid var(--border-color);
            box-shadow: 6px 6px 0px rgba(0,0,0,0.8);
            border-radius: 0px;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .retro-input {
            width: 100%;
            background: white;
            border: 2px solid var(--border-color);
            padding: 10px;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            outline: none;
            box-shadow: inset 2px 2px 0px rgba(0,0,0,0.1);
        }
        .retro-input:focus {
            background: #fff;
            box-shadow: inset 2px 2px 0px rgba(0,0,0,0.2);
        }

        .retro-btn {
            background-color: var(--accent-yellow);
            border: 2px solid var(--border-color);
            padding: 8px 16px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 2px 2px 0px var(--border-color);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .retro-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 0px 0px 0px var(--border-color);
        }
        
        .retro-btn.primary { background-color: var(--accent-yellow); }
        .retro-btn.danger { background-color: var(--accent-red); }
        .retro-btn.success { background-color: #86efac; }
        .retro-btn.neutral { background-color: #e5e7eb; }

        .title-bar {
            background-color: var(--accent-blue);
            border-bottom: 3px solid var(--border-color);
            padding: 5px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            color: var(--border-color);
            font-weight: bold;
        }

        .pixel-font { font-family: 'VT323', monospace; }
        
        /* íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .tab-active {
            background-color: var(--window-bg) !important;
            border-bottom: none !important;
            position: relative;
            top: 2px;
        }

        @keyframes flip {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }
        .loading-icon { animation: flip 2s infinite ease-in-out; }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }
    </style>
</head>
<body>

    <div id="app" class="app-container">
        
        <!-- 1. ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
        <div id="auth-screen" class="flex flex-col gap-6 justify-center min-h-[80vh]">
            <div class="retro-box p-0">
                <div class="title-bar">
                    <span>SYSTEM_LOGIN.EXE</span>
                    <div class="flex gap-1">
                        <div class="w-3 h-3 border border-black bg-white"></div>
                        <div class="w-3 h-3 border border-black bg-white"></div>
                    </div>
                </div>
                <div class="p-6 flex flex-col gap-4">
                    <div class="text-center mb-4">
                        <h1 class="text-3xl font-bold pixel-font">RETRO QUOTES</h1>
                        <p class="text-sm text-gray-600">ë‹¹ì‹ ì˜ ì˜ê°ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
                    </div>

                    <div class="flex gap-2 mb-2">
                        <button onclick="switchAuthMode('login')" id="tab-login" class="retro-btn flex-1 bg-white">ë¡œê·¸ì¸</button>
                        <button onclick="switchAuthMode('signup')" id="tab-signup" class="retro-btn flex-1 bg-gray-200">ê°€ì…</button>
                    </div>

                    <form id="auth-form" onsubmit="handleAuth(event)">
                        <div class="flex flex-col gap-3">
                            <input type="email" id="email" placeholder="E-MAIL" class="retro-input" required>
                            <input type="password" id="password" placeholder="PASSWORD" class="retro-input" required>
                            
                            <div id="signup-fields" class="hidden flex flex-col gap-3">
                                <input type="text" id="nickname" placeholder="NICKNAME" class="retro-input">
                                <input type="text" id="profileUrl" placeholder="PROFILE IMG URL" class="retro-input">
                                <select id="userRole" class="retro-input">
                                    <option value="USER">USER</option>
                                    <option value="ADMIN">ADMIN</option>
                                </select>
                            </div>

                            <button type="submit" class="retro-btn primary w-full mt-4 h-12 text-lg">
                                ENTER SYSTEM
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 2. ë©”ì¸ í™”ë©´ (í”¼ë“œ) -->
        <div id="main-screen" class="hidden">
            <header class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold pixel-font bg-white border-2 border-black px-2 shadow-[2px_2px_0px_rgba(0,0,0,1)]">QUOTES_FEED</h2>
                <div class="flex gap-2">
                    <button onclick="goToMyPage()" class="retro-btn success text-xs px-3 py-1">MY PAGE</button>
                </div>
            </header>

            <div class="mb-6 retro-box p-2 flex gap-2">
                <i data-lucide="search" class="w-6 h-6"></i>
                <input type="text" placeholder="Search quotes..." class="bg-transparent outline-none w-full font-mono">
            </div>

            <div id="quotes-list" class="flex flex-col gap-6">
                <!-- Data will be loaded here -->
            </div>
        </div>

        <!-- 3. ë§ˆì´í˜ì´ì§€ í™”ë©´ (New!) -->
        <div id="mypage-screen" class="hidden">
            <header class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold pixel-font bg-white border-2 border-black px-2 shadow-[2px_2px_0px_rgba(0,0,0,1)]">MY_PAGE</h2>
                <div class="flex gap-2">
                    <button onclick="showMainScreen()" class="retro-btn neutral text-xs px-2 py-1">HOME</button>
                    <button onclick="logout()" class="retro-btn danger text-xs px-2 py-1">LOGOUT</button>
                </div>
            </header>

            <!-- í”„ë¡œí•„ ì„¹ì…˜ -->
            <div class="retro-box p-4 mb-6 flex items-center gap-4">
                <div class="w-16 h-16 bg-gray-300 border-2 border-black overflow-hidden relative">
                     <img id="my-profile-img" src="" onerror="this.src='https://via.placeholder.com/150'" class="w-full h-full object-cover hidden">
                     <i data-lucide="user" class="w-8 h-8 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-gray-500"></i>
                </div>
                <div>
                    <h3 id="my-nickname" class="text-xl font-bold pixel-font">LOADING...</h3>
                    <p id="my-email" class="text-xs text-gray-500">user@email.com</p>
                    <span id="my-role" class="text-[10px] bg-blue-200 px-1 border border-black mt-1 inline-block">USER</span>
                </div>
            </div>

            <!-- íƒ­ ë©”ë‰´ -->
            <div class="flex border-b-2 border-black mb-4 px-2 gap-2">
                <button onclick="switchMyPageTab('my-quotes')" id="btn-tab-my" class="retro-btn bg-gray-300 border-b-0 rounded-b-none px-4 py-2 text-sm">ë‚´ê°€ ì“´ ê¸€</button>
                <button onclick="switchMyPageTab('likes')" id="btn-tab-likes" class="retro-btn bg-gray-300 border-b-0 rounded-b-none px-4 py-2 text-sm">ì¢‹ì•„ìš”</button>
            </div>

            <!-- ë§ˆì´í˜ì´ì§€ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
            <div id="mypage-list" class="flex flex-col gap-4">
                <!-- ì—¬ê¸°ì— ë‚´ê°€ ì“´ ê¸€ì´ë‚˜ ì¢‹ì•„ìš” ëª©ë¡ì´ ë Œë”ë§ë¨ -->
            </div>
        </div>

        <!-- í”Œë¡œíŒ… ë²„íŠ¼ -->
        <button onclick="openModal()" id="fab-btn" class="hidden fixed bottom-6 right-6 w-14 h-14 bg-[#86efac] border-2 border-black shadow-[4px_4px_0px_rgba(0,0,0,1)] flex items-center justify-center rounded-full hover:translate-y-1 transition-all z-50">
            <i data-lucide="plus" class="w-8 h-8 text-black"></i>
        </button>

    </div>

    <!-- ëª¨ë‹¬ -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/50 hidden z-[100] flex items-center justify-center p-4">
        <div class="retro-box w-full max-w-md bg-[#fff1e6] animate-bounce-in relative">
            <div class="title-bar bg-[#fca5a5]">
                <span>NEW_QUOTE.TXT</span>
                <button onclick="closeModal()" class="hover:bg-red-400 p-1"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            
            <form id="quote-form" onsubmit="createQuote(event)" class="p-4 flex flex-col gap-3">
                <label class="text-xs font-bold">SENTENCE</label>
                <textarea id="q-sentence" rows="3" class="retro-input" placeholder="ì—¬ê¸°ì— ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                
                <label class="text-xs font-bold">THOUGHT</label>
                <textarea id="q-thought" rows="2" class="retro-input" placeholder="ë‹¹ì‹ ì˜ ìƒê°ì€?"></textarea>

                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-xs font-bold">AUTHOR</label>
                        <input type="text" id="q-author" class="retro-input" placeholder="ì €ì">
                    </div>
                    <div>
                        <label class="text-xs font-bold">PAGE</label>
                        <input type="number" id="q-page" class="retro-input" placeholder="í˜ì´ì§€">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-xs font-bold">CATEGORY</label>
                        <select id="q-category" class="retro-input">
                            <option value="NOVEL">ì†Œì„¤</option>
                            <option value="POETRY">ì‹œ</option>
                            <option value="SCENARIO">ì‹œë‚˜ë¦¬ì˜¤</option>
                            <option value="ESSAY">ìˆ˜í•„</option>
                            <option value="PLAY">í¬ê³¡</option>
                            <option value="AUTOBIOGRAPHY">ìì„œì „</option>
                            <option value="MEMOIR">íšŒê³ ë¡</option>
                            <option value="CHILDREN_LITERATURE">ì•„ë™ë¬¸í•™</option>
                            <option value="CRITICISM">ë¬¸í•™ë¹„í‰</option>
                        </select>
                    </div>
                    <div>
                         <label class="text-xs font-bold">PUBLIC</label>
                        <select id="q-public" class="retro-input">
                            <option value="PUBLIC">ê³µê°œ</option>
                            <option value="PRIVATE">ë¹„ê³µê°œ</option>
                        </select>
                    </div>
                </div>
                
                <label class="text-xs font-bold">TITLE (BOOK)</label>
                <input type="text" id="q-title" class="retro-input" placeholder="ì±… ì œëª©" required>

                <div class="flex gap-2 mt-4">
                    <button type="button" onclick="closeModal()" class="retro-btn w-1/2">CANCEL</button>
                    <button type="submit" class="retro-btn success w-1/2">SAVE</button>
                </div>
            </form>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-black text-white px-6 py-3 border-2 border-white shadow-lg hidden z-[200] pixel-font">
        MESSAGE HERE
    </div>

    <script>
        const API_BASE_URL = "http://localhost:8080"; 

        // ìƒíƒœ ê´€ë¦¬
        let currentAuthMode = 'login';
        let currentMyPageTab = 'my-quotes';
        let token = localStorage.getItem('accessToken');
        let myProfile = {}; // ë‚´ ì •ë³´ ì €ì¥ìš©

        // ì´ˆê¸° ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            checkAuth();
        });

        // ==========================================
        // 1. ì¸ì¦ ë¡œì§
        // ==========================================
        
        function checkAuth() {
            if (token) {
                showMainScreen();
                fetchQuotes();
                fetchMyProfile(); // ë¡œê·¸ì¸ ì‹œ ë‚´ ì •ë³´ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê¸°
            } else {
                showAuthScreen();
            }
        }

        function switchAuthMode(mode) {
            currentAuthMode = mode;
            const signupFields = document.getElementById('signup-fields');
            const tabLogin = document.getElementById('tab-login');
            const tabSignup = document.getElementById('tab-signup');
            const btn = document.querySelector('#auth-form button');

            if (mode === 'signup') {
                signupFields.classList.remove('hidden');
                tabSignup.classList.add('bg-white');
                tabSignup.classList.remove('bg-gray-200');
                tabLogin.classList.remove('bg-white');
                tabLogin.classList.add('bg-gray-200');
                btn.innerText = "REGISTER USER";
            } else {
                signupFields.classList.add('hidden');
                tabLogin.classList.add('bg-white');
                tabLogin.classList.remove('bg-gray-200');
                tabSignup.classList.remove('bg-white');
                tabSignup.classList.add('bg-gray-200');
                btn.innerText = "ENTER SYSTEM";
            }
        }

        async function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const endpoint = currentAuthMode === 'login' ? '/signin' : '/signup';
            
            const body = { email, password };
            if (currentAuthMode === 'signup') {
                body.nickname = document.getElementById('nickname').value;
                body.profileUrl = document.getElementById('profileUrl').value;
                body.userRole = document.getElementById('userRole').value;
            }

            try {
                const res = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (!res.ok) throw new Error('ì¸ì¦ ì‹¤íŒ¨!');
                const data = await res.json();

                if (currentAuthMode === 'signup') {
                    showToast("íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•˜ì„¸ìš”.");
                    switchAuthMode('login');
                } else {
                    token = data.token; 
                    localStorage.setItem('accessToken', token);
                    showToast("ì‹œìŠ¤í…œ ì ‘ì† ì„±ê³µ");
                    checkAuth();
                }
            } catch (err) {
                showToast(err.message);
            }
        }

        function logout() {
            localStorage.clear();
            token = null;
            location.reload();
        }

        async function fetchMyProfile() {
            try {
                const res = await fetch(`${API_BASE_URL}/users`, {
                    headers: { 'Authorization': token }
                });
                if(res.ok) {
                    myProfile = await res.json();
                }
            } catch(e) { console.error("í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨", e); }
        }

        // ==========================================
        // 2. ì¸ìš©êµ¬ ê´€ë¦¬ ë¡œì§
        // ==========================================

        async function fetchQuotes() {
            const listEl = document.getElementById('quotes-list');
            try {
                const res = await fetch(`${API_BASE_URL}/quotes`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json', 'Authorization': token }
                });
                if (!res.ok) throw new Error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                const data = await res.json();
                renderQuotes(data.content, 'quotes-list');
            } catch (err) {
                listEl.innerHTML = `<div class="text-red-500 text-center p-4">ERROR: ${err.message}</div>`;
            }
        }

        function renderQuotes(quotes, targetId) {
            const listEl = document.getElementById(targetId);
            listEl.innerHTML = '';

            if (!quotes || quotes.length === 0) {
                listEl.innerHTML = `<div class="text-center text-gray-500 py-10 pixel-font">NO DATA FOUND.</div>`;
                return;
            }

            quotes.forEach(q => {
                const date = new Date(q.createdAt).toLocaleDateString();
                const item = document.createElement('div');
                item.className = 'retro-box p-0 mb-4';
                item.innerHTML = `
                    <div class="title-bar bg-white !border-b-2">
                        <span class="text-sm truncate max-w-[200px]">${q.title} (${q.pageNumber}p)</span>
                        <div class="flex gap-2">
                            <span class="text-xs bg-gray-200 px-1 border border-black">${q.category}</span>
                        </div>
                    </div>
                    <div class="p-4 bg-[#fff]">
                        <p class="text-lg font-serif mb-4 leading-relaxed">"${q.sentence}"</p>
                        ${q.thought ? `<div class="bg-[#f0f9ff] p-2 text-sm border-l-4 border-blue-400 mb-4 text-gray-600"><span class="font-bold mr-2">ğŸ’­ THOUGHT:</span> ${q.thought}</div>` : ''}
                        <div class="flex justify-between items-end border-t border-dashed border-gray-400 pt-3 mt-2">
                            <div class="flex flex-col">
                                <span class="text-xs font-bold">@${q.nickname}</span>
                                <span class="text-[10px] text-gray-500">${date}</span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="likeQuote(${q.id})" class="p-2 hover:bg-red-100 border border-transparent hover:border-black transition-all rounded-full"><i data-lucide="heart" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    </div>
                `;
                listEl.appendChild(item);
            });
            lucide.createIcons();
        }

        async function createQuote(e) {
            e.preventDefault();
            const body = {
                title: document.getElementById('q-title').value,
                author: document.getElementById('q-author').value,
                category: document.getElementById('q-category').value,
                pageNumber: parseInt(document.getElementById('q-page').value) || 0,
                sentence: document.getElementById('q-sentence').value,
                thought: document.getElementById('q-thought').value,
                isPublic: document.getElementById('q-public').value
            };

            try {
                const res = await fetch(`${API_BASE_URL}/quotes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': token },
                    body: JSON.stringify(body)
                });
                if (!res.ok) throw new Error("ì‘ì„± ì‹¤íŒ¨!");
                showToast("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
                closeModal();
                fetchQuotes();
            } catch (err) { showToast(err.message); }
        }

        async function likeQuote(quoteId) {
            try {
                const res = await fetch(`${API_BASE_URL}/quotes/${quoteId}/likes`, {
                    method: 'POST',
                    headers: { 'Authorization': token, 'Content-Type': 'application/json' }
                });
                if(res.ok) showToast("ì´ ê¸€ì„ ì¢‹ì•„í•©ë‹ˆë‹¤!");
                else showToast("ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ!");
            } catch(e) { showToast("í†µì‹  ì˜¤ë¥˜"); }
        }

        // ==========================================
        // 3. ë§ˆì´í˜ì´ì§€ ë¡œì§ (New!)
        // ==========================================

        async function goToMyPage() {
            // UI ì „í™˜
            document.getElementById('main-screen').classList.add('hidden');
            document.getElementById('mypage-screen').classList.remove('hidden');
            document.getElementById('fab-btn').classList.add('hidden'); // ë§ˆì´í˜ì´ì§€ì—ì„  ê¸€ì“°ê¸° ë²„íŠ¼ ìˆ¨ê¹€

            // í”„ë¡œí•„ ì •ë³´ ë Œë”ë§
            if(myProfile.nickname) {
                document.getElementById('my-nickname').innerText = myProfile.nickname;
                document.getElementById('my-email').innerText = myProfile.email;
                document.getElementById('my-role').innerText = myProfile.userRole;
                if(myProfile.profileUrl) {
                    const img = document.getElementById('my-profile-img');
                    img.src = myProfile.profileUrl;
                    img.classList.remove('hidden');
                }
            } else {
                await fetchMyProfile(); // ì—†ìœ¼ë©´ ë‹¤ì‹œ ì‹œë„
                goToMyPage(); // ì¬ê·€ í˜¸ì¶œë¡œ ë‹¤ì‹œ ë Œë”ë§
                return;
            }

            // ì´ˆê¸° íƒ­ ë¡œë“œ (ë‚´ê°€ ì“´ ê¸€)
            switchMyPageTab('my-quotes');
        }

        async function switchMyPageTab(tab) {
            currentMyPageTab = tab;
            const btnMy = document.getElementById('btn-tab-my');
            const btnLikes = document.getElementById('btn-tab-likes');
            const listEl = document.getElementById('mypage-list');

            listEl.innerHTML = '<div class="text-center py-4"><i data-lucide="hourglass" class="w-6 h-6 animate-spin mx-auto"></i></div>';

            // íƒ­ ìŠ¤íƒ€ì¼ ë³€ê²½
            if(tab === 'my-quotes') {
                btnMy.classList.add('tab-active', 'bg-[#fff1e6]');
                btnMy.classList.remove('bg-gray-300');
                btnLikes.classList.remove('tab-active', 'bg-[#fff1e6]');
                btnLikes.classList.add('bg-gray-300');
                
                // [ë‚´ê°€ ì“´ ê¸€ ì¡°íšŒ]
                // API ëª…ì„¸ì— ê²€ìƒ‰ í•„í„°ê°€ ì—†ìœ¼ë¯€ë¡œ ì „ì²´ë¥¼ ê°€ì ¸ì™€ì„œ ë‹‰ë„¤ì„ìœ¼ë¡œ í•„í„°ë§
                try {
                    const res = await fetch(`${API_BASE_URL}/quotes`, {
                        headers: { 'Authorization': token }
                    });
                    const data = await res.json();
                    // ë‚´ ë‹‰ë„¤ì„ê³¼ ê°™ì€ ê²ƒë§Œ í•„í„°ë§
                    const myQuotes = data.content.filter(q => q.nickname === myProfile.nickname);
                    renderQuotes(myQuotes, 'mypage-list');
                } catch(e) {
                    listEl.innerHTML = "ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨";
                }

            } else {
                btnLikes.classList.add('tab-active', 'bg-[#fff1e6]');
                btnLikes.classList.remove('bg-gray-300');
                btnMy.classList.remove('tab-active', 'bg-[#fff1e6]');
                btnMy.classList.add('bg-gray-300');

                // [ì¢‹ì•„ìš” í•œ ê¸€ ì¡°íšŒ]
                try {
                    const res = await fetch(`${API_BASE_URL}/likes`, {
                        headers: { 'Authorization': token }
                    });
                    const data = await res.json(); // { content: [{quoteId, title, category}], ... }
                    renderLikedQuotes(data.content);
                } catch(e) {
                    listEl.innerHTML = "ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨";
                }
            }
        }

        // ì¢‹ì•„ìš” ëª©ë¡ì€ APIê°€ ì£¼ëŠ” ì •ë³´(title, category)ê°€ ì œí•œì ì´ë¯€ë¡œ UIë¥¼ ë‹¤ë¥´ê²Œ ê·¸ë¦¼
        function renderLikedQuotes(likes) {
            const listEl = document.getElementById('mypage-list');
            listEl.innerHTML = '';
            
            if (!likes || likes.length === 0) {
                listEl.innerHTML = `<div class="text-center text-gray-500 py-10 pixel-font">NO LIKES YET.</div>`;
                return;
            }

            likes.forEach(item => {
                const el = document.createElement('div');
                el.className = 'retro-box p-3 bg-white flex justify-between items-center';
                el.innerHTML = `
                    <div class="flex flex-col">
                        <span class="font-bold text-lg">${item.title}</span>
                        <span class="text-xs bg-gray-200 px-1 border border-black w-fit">${item.category}</span>
                    </div>
                    <button class="retro-btn danger px-2 py-1 text-xs">VIEW</button>
                `;
                listEl.appendChild(el);
            });
        }

        // ==========================================
        // 4. UI ìœ í‹¸ë¦¬í‹°
        // ==========================================

        function showAuthScreen() {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-screen').classList.add('hidden');
            document.getElementById('mypage-screen').classList.add('hidden');
            document.getElementById('fab-btn').classList.add('hidden');
        }

        function showMainScreen() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('mypage-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('fab-btn').classList.remove('hidden');
            fetchQuotes(); // ëª©ë¡ ê°±ì‹ 
        }

        function openModal() { document.getElementById('modal-overlay').classList.remove('hidden'); }
        function closeModal() { document.getElementById('modal-overlay').classList.add('hidden'); document.getElementById('quote-form').reset(); }
        
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }
    </script>
</body>
</html>